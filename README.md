# yt_subs_dl

This project provides a CLI tool to download and
format subtitles from YouTube videos.

## Overview

The tool extracts the text from a video's subtitles, joining them together
into a more readable format. It can insert newlines for long pauses and
handles language-specific spacing (e.g., adding spaces for English but
not for Japanese).

## Getting Started

This project can be set up using Nix for a reproducible development environment or with a standard Python setup.

### For Nix Users (Recommended)

This project uses [Nix](https://nixos.org/) to manage the development environment, ensuring all dependencies are handled reproducibly.

1.  **Install Nix:** If you don't have Nix installed, follow the instructions at [nixos.org](https://nixos.org/download.html).
2.  **Enable Flakes:** Ensure that Nix Flakes are enabled. You may need to add `experimental-features = nix-command flakes` to your Nix configuration.
3.  **Enter the Development Shell:** Navigate to the project directory and run:

    ```bash
    nix develop
    ```

    This command will automatically download and set up all the necessary dependencies, including Python and the required libraries.

### For Non-Nix Users

You can set up the project using a standard Python environment and `pip`.

1.  **Install Python:** Ensure you have Python 3.8+ installed on your system.
2.  **Create a Virtual Environment (Recommended):**

    ```bash
    python3 -m venv .venv
    source .venv/bin/activate
    ```

3.  **Install Dependencies:**

    ```bash
    pip install -r requirements.txt
    ```

## Usage

### For Nix Users

Once inside the development shell (after `nix develop`), or directly from your shell, you can run the script using `nix run`:

```bash
nix run .#default "<YOUTUBE_VIDEO_URL>"
```

### For Non-Nix Users

If you set up the project without Nix, activate your virtual environment first (if you created one), then run the script using `python3`:

```bash
source .venv/bin/activate # If using a virtual environment
python3 yt_subs_dl.py "<YOUTUBE_VIDEO_URL>"
```

### Options

- `-t, --threshold <SECONDS>`: Set the time threshold (in seconds) for
  inserting a newline. Default is `5.0`.
- `-l, --languages <LANG_CODES>`: Comma-separated list of preferred
  language codes (e.g., `en,ja`). Default is `ja,en`.
- `-D, --no-prefer-default-language`: Do not automatically prioritize
  the video's native language.
- `-v, --verbose`: Enable verbose output, showing selected language and
  raw VTT content.
- `-r, --raw`: Output the raw SRT content without any formatting.
- `--help`: Show the help message.

### Examples

**For Nix Users:**

**Download Japanese subtitles (default behavior):**

```bash
nix run .#default "https://www.youtube.com/watch?v=..."
```

**Download English subtitles with a 3.5-second threshold:**

```bash
nix run .#default -- --languages en --threshold 3.5 "https://www.youtube.com/watch?v=..."
```

**For Non-Nix Users:**

**Download Japanese subtitles (default behavior):**

```bash
python3 yt_subs_dl.py "https://www.youtube.com/watch?v=..."
```

**Download English subtitles with a 3.5-second threshold:**

```bash
python3 yt_subs_dl.py --languages en --threshold 3.5 "https://www.youtube.com/watch?v=..."
```

## Development

### For Nix Users

The development environment is defined in `flake.nix`.

-   **Adding Dependencies:** If you need to add new Python packages, add them to the `buildInputs` list within the `flake.nix` file and re-run `nix develop` to update your environment.
-   **Running Tests:**

    ```bash
    nix run .#test
    ```

-   **Linting & Formatting (Ruff):**

    ```bash
    nix run .#lint
    nix run .#format-py
    ```

### For Non-Nix Users

-   **Adding Dependencies:** Add new Python packages to `requirements.txt` and install them using `pip install -r requirements.txt`.
-   **Running Tests:**

    ```bash
    pytest
    ```

-   **Linting & Formatting (Ruff):**

    ```bash
    ruff check .
    ruff format .
    ```

The main application logic is in `yt_subs_dl.py`.

### AI Generation

A significant portion of the code in this project has been generated by
an AI assistant, specifically `gemini-cli`. This approach aims to
accelerate development and maintain code quality.
